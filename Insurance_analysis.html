<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººä¿éšªä¿éšœç›¤é»è¡¨ - ä¿®æ­£ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f4f8; color: #334155; }
        table { border-collapse: collapse; width: 100%; table-layout: fixed; background: white; border: 1px solid #cbd5e1; }
        th, td { border: 1px solid #cbd5e1; padding: 4px 6px; font-size: 0.8rem; vertical-align: middle; }
        .stage-header { background-color: #1e293b; text-align: center; color: #ffffff; }
        .risk-label { background-color: #f1f5f9; font-weight: bold; color: #1e293b; text-align: center; }
        .big-icon { font-size: 3.2rem; opacity: 0.8; margin-right: 12px; vertical-align: middle; line-height: 1; }
        .content-cell { display: flex; align-items: center; justify-content: center; padding: 8px 0; }
        .amount-group { display: inline-flex; flex-direction: column; align-items: center; margin: 0px 8px; }
        .amount-label { font-size: 0.6rem; color: #64748b; font-weight: bold; line-height: 1.2; }
        .amount-input { border: none; border-bottom: 1px solid #e2e8f0; width: 85px; text-align: center; background: transparent; font-size: 0.9rem; font-weight: 600; color: #0f172a; height: 22px; }
        .amount-input:focus { outline: none; border-bottom: 2px solid #38bdf8; }
        .company-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; line-height: 1; }
        .company-item { display: flex; align-items: center; font-size: 0.62rem; color: #475569; cursor: pointer; }
        .company-item input { margin-right: 2px; transform: scale(0.7); }

        /* æˆªåœ–æ¨¡å¼ */
        .screenshot-mode { background: #0f172a !important; padding: 10px !important; }
        .screenshot-mode .no-print { display: none !important; }
        .screenshot-mode td { background-color: #ffffff !important; }
        .screenshot-mode td[colspan] { background-color: #f8fafc !important; } 
        .screenshot-mode .risk-label { background-color: #f1f5f9 !important; }
        .screenshot-mode #capture-area { border: none; padding: 15px; background: #fdfdfd; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .screenshot-mode .amount-input { border-bottom: none; font-weight: 800; color: #0284c7; }
        .screenshot-mode .company-display { display: block !important; color: #1e293b; font-weight: 600; font-size: 0.65rem; background: #f1f5f9; padding: 4px; border-radius: 4px; border-left: 3px solid #0ea5e9; }
    </style>
</head>
<body class="p-2 lg:p-4">

    <div id="capture-area" class="max-w-[1100px] mx-auto bg-white p-4 rounded-xl border border-slate-200">
        <div class="flex justify-between items-end mb-1 px-1">
            <div class="w-1/3"></div>
            <div class="w-1/3 text-center">
                <h1 class="text-xl font-black text-slate-800 tracking-tight leading-none">å€‹äººäººèº«ä¿éšªä¿éšœç›¤é»è¡¨</h1>
                <p class="text-slate-400 text-[8px] mt-1 uppercase tracking-widest font-bold">Insurance Portfolio Analysis</p>
            </div>
            <div class="w-1/3 text-right">
                <p id="current-time" class="text-slate-600 text-[9px] font-bold"></p>
            </div>
        </div>
        
        <table id="main-table">
            <thead>
                <tr class="stage-header">
                    <th class="w-20 font-bold py-1.5 text-[0.75rem]">é¢¨éšªé¡åˆ¥</th>
                    <th class="py-1.5 text-[0.7rem]">1. å‡ºç”Ÿ-å‡ºç¤¾æœƒ</th>
                    <th class="py-1.5 text-[0.7rem]">2. ç¤¾æœƒ-æˆå®¶</th>
                    <th class="py-1.5 text-[0.7rem]">3. æˆå®¶-é€€ä¼‘</th>
                    <th class="py-1.5 text-[0.7rem]">4. é€€ä¼‘-èº«æ•…</th>
                    <th class="w-[220px] font-semibold text-[0.75rem]">æŠ•ä¿ä¿éšªå…¬å¸</th>
                </tr>
            </thead>
            <tbody>
                <tr data-category="é†«ç™‚éšª">
                    <td class="risk-label">é†«ç™‚æ”¯æ‡‰</td>
                    <td colspan="4" class="bg-cyan-50/20">
                        <div class="content-cell">
                            <span class="big-icon">ğŸ¥</span>
                            <div class="text-center">
                                <strong>é†«ç™‚éšª</strong> <span class="text-[9px] text-slate-400">(ä½é™¢ã€æ‰‹è¡“è²»ã€é†«ç™‚é›œè²»)</span><br>
                                <div class="amount-group"><span class="amount-label">ä½é™¢æ—¥é¡</span><span>$<input type="text" class="amount-input val-1" placeholder="0"></span></div>
                                <div class="amount-group"><span class="amount-label">é–€è¨ºæ‰‹è¡“è²»</span><span>$<input type="text" class="amount-input val-2" placeholder="0"></span></div>
                                <div class="amount-group"><span class="amount-label">ä½é™¢æ‰‹è¡“è²»</span><span>$<input type="text" class="amount-input val-3" placeholder="0"></span></div>
                                <div class="amount-group"><span class="amount-label">é†«ç™‚é›œè²»</span><span>$<input type="text" class="amount-input val-4" placeholder="0"></span></div>
                            </div>
                        </div>
                    </td>
                    <td><div class="company-grid no-print"></div><div class="company-display hidden"></div></td>
                </tr>
                <tr data-category="ç™Œç—‡éšª">
                    <td class="risk-label">ç™Œç—‡é˜²è­·</td>
                    <td colspan="3" class="bg-blue-50/20">
                        <div class="content-cell">
                            <span class="big-icon">ğŸ—ï¸</span>
                            <div class="text-center">
                                <strong>ç™Œç—‡éšª</strong><br>
                                <div class="amount-group"><span class="amount-label">ç™Œç—‡ä¿é¡</span><span>$<input type="text" class="amount-input val-1" placeholder="0"></span></div>
                                <div class="amount-group"><span class="amount-label">ä½é™¢æ—¥é¡</span><span>$<input type="text" class="amount-input val-2" placeholder="0"></span></div>
                            </div>
                        </div>
                    </td>
                    <td class="text-center text-slate-300 bg-slate-50 italic text-[9px]">è‡ªå‚™æº–å‚™é‡‘</td>
                    <td><div class="company-grid no-print"></div><div class="company-display hidden"></div></td>
                </tr>
                <tr data-category="æ„å¤–éšª">
                    <td class="risk-label">æ„å¤–é¢¨éšª</td>
                    <td colspan="4" class="bg-green-50/20">
                        <div class="content-cell">
                            <span class="big-icon">âš ï¸</span>
                            <div class="text-center">
                                <strong>æ„å¤–éšª</strong><br>
                                <div class="amount-group"><span class="amount-label">æ„å¤–ä¿é¡</span><span>$<input type="text" class="amount-input val-1" placeholder="0"></span></div>
                                <div class="amount-group"><span class="amount-label">å¯¦æ”¯å¯¦ä»˜é¡åº¦</span><span>$<input type="text" class="amount-input val-2" placeholder="0"></span></div>
                                <div class="amount-group"><span class="amount-label">ä½é™¢æ—¥é¡</span><span>$<input type="text" class="amount-input val-3" placeholder="0"></span></div>
                            </div>
                        </div>
                    </td>
                    <td><div class="company-grid no-print"></div><div class="company-display hidden"></div></td>
                </tr>
                <tr data-category="å£½éšª">
                    <td class="risk-label">åŸºç¤è²¬ä»»</td>
                    <td colspan="3" class="bg-red-50/20">
                        <div class="content-cell">
                            <span class="big-icon">ğŸ </span>
                            <div class="text-center">
                                <strong>å£½éšª</strong><br>
                                <div class="amount-group"><span class="amount-label">ä¿éšœé‡‘é¡</span><span>$<input type="text" class="amount-input val-1" placeholder="0"></span></div>
                            </div>
                        </div>
                    </td>
                    <td class="bg-slate-100"></td>
                    <td><div class="company-grid no-print"></div><div class="company-display hidden"></div></td>
                </tr>
                <tr data-category="é‡å¤§ç–¾ç—…éšª">
                    <td class="risk-label">é‡å¤§é¢¨éšª</td>
                    <td class="bg-slate-100"></td>
                    <td colspan="2" class="bg-purple-50/20">
                        <div class="content-cell">
                            <span class="big-icon">ğŸ©º</span>
                            <div class="text-center">
                                <strong>é‡å¤§ç–¾ç—…éšª</strong><br>
                                <div class="amount-group"><span class="amount-label">ä¿éšœé‡‘é¡</span><span>$<input type="text" class="amount-input val-1" placeholder="0"></span></div>
                            </div>
                        </div>
                    </td>
                    <td class="text-center text-slate-300 bg-slate-50 italic text-[9px]">è‡ªå‚™æº–å‚™é‡‘</td>
                    <td><div class="company-grid no-print"></div><div class="company-display hidden"></div></td>
                </tr>
                <tr data-category="è³‡ç”¢é…ç½®">
                    <td class="risk-label">è³‡ç”¢é…ç½®</td>
                    <td class="bg-slate-100"></td>
                    <td colspan="3" class="bg-yellow-50/20">
                        <div class="content-cell">
                            <span class="big-icon">ğŸ’°</span>
                            <div class="text-center">
                                <strong>æŠ•è³‡å‹ä¿å–® / å¹´é‡‘</strong><br>
                                <div class="amount-group"><span class="amount-label">ç›®å‰åƒ¹å€¼</span><span>$<input type="text" class="amount-input val-1" placeholder="0"></span></div>
                            </div>
                        </div>
                    </td>
                    <td><div class="company-grid no-print"></div><div class="company-display hidden"></div></td>
                </tr>
                <tr data-category="é•·æœŸç…§é¡§éšª">
                    <td class="risk-label">é•·æœŸç…§è­·</td>
                    <td class="bg-slate-100"></td>
                    <td class="bg-slate-100"></td>
                    <td colspan="2" class="bg-slate-50">
                        <div class="content-cell">
                            <span class="big-icon">ğŸ‘©â€ğŸ¦½</span>
                            <div class="text-center">
                                <strong>é•·æœŸç…§é¡§éšª/å¤±èƒ½éšª</strong><br>
                                <div class="amount-group"><span class="amount-label">æ¯å¹´çµ¦ä»˜</span><span>$<input type="text" class="amount-input val-1" placeholder="0"></span></div>
                                <div class="amount-group"><span class="amount-label">æ®˜å»¢å®‰é¤Š(ä¸€ç­†)</span><span>$<input type="text" class="amount-input val-2" placeholder="0"></span></div>
                            </div>
                        </div>
                    </td>
                    <td><div class="company-grid no-print"></div><div class="company-display hidden"></div></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="max-w-[1100px] mx-auto mt-4 flex flex-wrap justify-center gap-2 no-print">
        <button onclick="document.getElementById('importFile').click()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-1.5 px-5 rounded-lg text-xs">ğŸ“‚ åŒ¯å…¥</button>
        <input type="file" id="importFile" class="hidden" accept=".xlsx, .xls" onchange="importFromExcel(event)">
        <button onclick="exportToExcel()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-1.5 px-5 rounded-lg text-xs">ğŸ“Š åŒ¯å‡º</button>        
        <button onclick="generateImage()" class="bg-slate-800 hover:bg-black text-white font-bold py-1.5 px-5 rounded-lg text-xs">ğŸ“¸ æˆªåœ–</button>
        <button onclick="window.location.reload()" class="bg-white border border-slate-300 text-slate-500 py-1.5 px-5 rounded-lg text-xs">é‡ç½®</button>
    </div>

    <script>
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').innerText = `ç›¤é»ï¼š${now.getFullYear()}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }
        updateTime();

        const companies = ["åœ‹æ³°äººå£½", "å¯Œé‚¦äººå£½", "å—å±±äººå£½", "æ–°å…‰äººå£½", "å°ç£äººå£½", "ä¸‰å•†ç¾é‚¦", "é é›„äººå£½", "å…¨çƒäººå£½", "ä¿èª äººå£½", "å®‰è¯äººå£½", "å®‰é”äººå£½", "å‹é‚¦äººå£½", "åœ‹æ³°ç”¢éšª", "æ–°å…‰ç”¢éšª", "å¯Œé‚¦ç”¢éšª"];

        document.querySelectorAll('.company-grid').forEach(grid => {
            companies.forEach(company => {
                const label = document.createElement('label');
                label.className = 'company-item';
                label.innerHTML = `<input type="checkbox" value="${company}"> <span style="font-size:10px">${company}</span>`;
                grid.appendChild(label);
            });
        });

        function generateImage() {
            updateTime();
            document.querySelectorAll('.company-grid').forEach(grid => {
                const display = grid.nextElementSibling;
                const checked = Array.from(grid.querySelectorAll('input:checked')).map(i => i.value);
                if (display) display.innerText = checked.length > 0 ? "å·²æŠ•ä¿ï¼š" + checked.join('ã€') : 'å…¬å¸ï¼šæœªå¡«';
            });
            document.body.classList.add('screenshot-mode');
            window.scrollTo(0, 0);
            setTimeout(() => {
                document.body.onclick = function() {
                    document.body.classList.remove('screenshot-mode');
                    document.body.onclick = null;
                };
            }, 500);
        }

        // --- ä¿®æ­£å¾Œçš„åŒ¯å‡ºå‡½å¼ ---
        function exportToExcel() {
            const data = [];
            document.querySelectorAll('tbody tr').forEach(row => {
                const category = row.getAttribute('data-category');
                if (!category) return;
                
                // å‹•æ…‹æŠ“å–æ‰€æœ‰ val-x çš„å€¼
                const rowData = { "éšªç¨®é …ç›®": category };
                const inputs = row.querySelectorAll('.amount-input');
                inputs.forEach((input, index) => {
                    rowData[`é¡åº¦${index + 1}`] = input.value || "";
                });
                
                const selectedCos = Array.from(row.querySelectorAll('.company-grid input:checked')).map(i => i.value).join(', ');
                rowData["æŠ•ä¿å…¬å¸"] = selectedCos;
                
                data.push(rowData);
            });
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ä¿éšªè³‡æ–™");
            XLSX.writeFile(wb, `ä¿éšªç›¤é»è¡¨_${new Date().toLocaleDateString()}.xlsx`);
        }

        // --- ä¿®æ­£å¾Œçš„åŒ¯å…¥å‡½å¼ ---
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const json = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                json.forEach(item => {
                    const row = document.querySelector(`tr[data-category="${item['éšªç¨®é …ç›®']}"]`);
                    if (row) {
                        // å‹•æ…‹å¡«å…¥æ‰€æœ‰é¡åº¦
                        for(let i=1; i<=4; i++) {
                            const valInput = row.querySelector(`.val-${i}`);
                            if (valInput) valInput.value = item[`é¡åº¦${i}`] || "";
                        }
                        
                        // è™•ç†ä¿éšªå…¬å¸
                        row.querySelectorAll('.company-grid input').forEach(cb => cb.checked = false);
                        if (item['æŠ•ä¿å…¬å¸']) {
                            item['æŠ•ä¿å…¬å¸'].split(', ').forEach(coName => {
                                const cb = Array.from(row.querySelectorAll('.company-grid input')).find(c => c.value === coName);
                                if (cb) cb.checked = true;
                            });
                        }
                    }
                });
                updateTime();
                alert("è³‡æ–™åŒ¯å…¥æˆåŠŸï¼");
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>